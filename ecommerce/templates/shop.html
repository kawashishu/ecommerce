{% extends 'base.html' %} {% load static %} {% block content %}
{% load i18n %}
{% load post_tags %}
<!-- Breadcrumb Start -->
<div class="container-fluid">
  <div class="row px-xl-5">
    <div class="col-12">
      <nav class="breadcrumb bg-light mb-30">
        <a class="breadcrumb-item text-dark" href="{% url 'index' %}">Home</a>
        <span class="breadcrumb-item active">Shop</span>
        
      </nav>
    </div>
  </div>
</div>
<!-- Breadcrumb End -->

<!-- Shop Start -->
<div class="container-fluid">
  <div class="row px-xl-5">
    <!-- Shop Sidebar Start -->
    <div class="col-lg-3 col-md-4">
      <form action="">
        <!-- Price Start -->
        <h5 class="section-title position-relative text-uppercase mb-3">
          <span class="bg-secondary pr-3">Filter by price</span>
        </h5>
        <div class="bg-light p-4 mb-30">
          <form>
            <div
              class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3"
            >
              <input
                type="checkbox"
                class="custom-control-input"
                checked
                id="price-all"
              />
              <label class="custom-control-label" for="price-all">
                All Price
              </label>
              <span class="badge border font-weight-normal">1000</span>
            </div>
            <div
              class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3"
            >
              <input
                type="checkbox"
                class="custom-control-input"
                id="price-1"
              />
              <label class="custom-control-label" for="price-1">
              {% multiply 20 currency as price_20 %}
              {% multiply 40 currency as price_40 %}
              {% multiply 60 currency as price_60 %}
              {% multiply 80 currency as price_80 %}
              {% multiply 100 currency as price_100 %}
              {% multiply 120 currency as price_120 %}
                {{price_20}} - {{ price_40 }} ( {% get_icon_currency currency_name %} )
              </label>
              <span class="badge border font-weight-normal">150</span>
            </div>
            <div
              class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3"
            >
              <input
                type="checkbox"
                class="custom-control-input"
                id="price-2"
              />
              <label class="custom-control-label" for="price-2">
                {{ price_40 }} - {{ price_60 }} ( {% get_icon_currency currency_name %} )
              </label>
              <span class="badge border font-weight-normal">295</span>
            </div>
            <div
              class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3"
            >
              <input
                type="checkbox" 
                class="custom-control-input"
                id="price-3"
              />
              <label class="custom-control-label" for="price-3">
                {{ price_60 }} - {{ price_80 }} ( {% get_icon_currency currency_name %})
              </label>
              <span class="badge border font-weight-normal">246</span>
            </div>
            <div
              class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3"
            >
              <input
                type="checkbox"
                class="custom-control-input"
                id="price-4"
              />
              <label class="custom-control-label" for="price-4">
                {{ price_80 }} - {{ price_100 }} ( {% get_icon_currency currency_name %})
              </label>
              <span class="badge border font-weight-normal">145</span>
            </div>
            <div
              class="custom-control custom-checkbox d-flex align-items-center justify-content-between"
            >
              <input
                type="checkbox"
                class="custom-control-input"
                id="price-5"
              />
              <label class="custom-control-label" for="price-5">
                {{ price_100 }} - {{ price_120 }} ( {% get_icon_currency currency_name %})
              </label>
              <span class="badge border font-weight-normal">168</span>
            </div>
          </form>
        </div>
        <!-- Price End -->

        <!-- Size End -->
      </form>
    </div>
    <!-- Shop Sidebar End -->

    <!-- Shop Product Start -->
    <div class="col-lg-9 col-md-8">
      <div class="row pb-3 products-item">
        <div class="col-12 pb-1">
          <div class="d-flex align-items-center justify-content-between mb-4">
            <div>
              <button class="btn btn-sm btn-light">
                <i class="fa fa-th-large"></i>
              </button>
              <button class="btn btn-sm btn-light ml-2">
                <i class="fa fa-bars"></i>
              </button>
            </div>

            <div class="ml-2">
              <div class="input-group">
                <input
                  type="text"
                  class="form-control form-control-search"
                  placeholder="Search for products"
                  name="query"
                />
                <div class="input-group-append">
                  <button
                    onclick="search_ajax()"
                    class="input-group-text bg-transparent text-primary"
                  >
                    <i class="fa fa-search"></i>
                  </button>
                </div>
              </div>

              <!-- </form> -->
            </div>

            <div class="ml-2">
              <div class="btn-group">
                <button
                  type="button"
                  class="btn btn-sm btn-light "
                >
                <a href="{% url 'sort_categories' product.id 'views' 'esc' %}" class="dropdown-item" href="#">{% trans "Popularity" %}</a>
                </button>
              </div>
              <div class="btn-group ml-2">
                <button 
                  type="button"
                  class="btn btn-sm btn-light dropdown-toggle"
                  data-toggle="dropdown"
                >
                {% trans "Price" %}
                </button>
                <div class="dropdown-menu dropdown-menu-right">
                  <a class="dropdown-item" href="{% url 'sort_categories' product.id 'price' 'asc' %}">{% trans "Up" %}</a>
                  <a class="dropdown-item" href="{% url 'sort_categories' product.id 'price' 'desc' %}">{% trans "Down" %}</a>
                </div>
              </div>
            </div>
          </div>
        </div>
       
        {% for product in products %}
        <div class="col-lg-4 col-md-6 col-sm-6 pb-1 products-container ">
          <div class="product-item bg-light mb-4">
            <div class="product-img position-relative overflow-hidden">
              <img
                class="img-fluid w-100"
                src="/ecommerce/media/{{product.avatar}}"
                alt="product"
              />
              <div class="product-action">
                <a 
                  onclick="addcart({{product.id}})"
                  class="btn btn-outline-dark btn-square liveToastBtn"
                >
                  <i class="fa fa-shopping-cart"></i>
                </a>
                <a onclick="addWishList({{product.id}})" class="btn btn-outline-dark btn-square liveToastBtn" >
                  <i class="far fa-heart "></i>
                </a>
                <!-- Toast Message -->
                <!--  -->
                <a
                  class="btn btn-outline-dark btn-square"
                  href=" {% url 'productdetail' product.id %} "
                >
                  <i class="fa fa-search"></i>
                </a>
              </div>
            </div>
            <div class="text-center py-4">
              <a class="h6 text-decoration-none text-truncate" href="">
                {{ product.title }}
                
              </a>
              <div
                class="d-flex align-items-center justify-content-center mt-2"
              >
              {% multiply product.price currency as price %}
                <h5>{{ price }} {% get_icon_currency currency_name %}</h5>
              </div>
              <div
                class="d-flex align-items-center justify-content-center mb-1"
              >
                <small class="fa fa-star text-primary mr-1"></small>
                <small class="fa fa-star text-primary mr-1"></small>
                <small class="fa fa-star text-primary mr-1"></small>
                <small class="fa fa-star text-primary mr-1"></small>
                <small class="fa fa-star text-primary mr-1"></small>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      {% if products.has_other_pages %}
    <div style="margin-left: 45%" aria-label="page navigation">
      <ul class="pagination align-items-center">
        {% if products.has_previous %}
        <li class="page-item previous-pagination">
          <a
            class="page-link"
            href="?page={{ products.previous_page_number }}"
            >{% trans "Previous" %}</a
          >
        </li>
        {% endif %}
        <li class="page-item one-pagination">
          <a class="page-link" href=" {% url 'index' %}?page=1">
            {% trans "Page" %} {{ products.number }} {% trans "of" %} {{products.paginator.num_pages }}
          </a>
        </li>
        {% if products.has_next %}
        <li class="page-item next-pagination">
          <a
            class="page-link"
            href="?page={{ products.next_page_number }}"
            >{% trans "Next" %}</a
          >
        </li>
        {% endif %}
      </ul>
    </div>
    {% endif %}
      </div>
    </div>
    <!-- Shop Product End -->
  </div>


</div>
      <div class="toast toast-success">
        <div class="toast-header">
          SUCCESS.........!
        </div>
        <div class="toast-body">
          Congratulations! Your action successfully .....
        </div>
    </div>

<!-- Shop End -->
<script
  src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"
  type="text/javascript"
></script>
<script>
  function AppendProducts(data) {
    $(".products-container").remove();
    let htmls = ''
        products = data.products
        for (let i = 0; i < products.length; i++) {
          id = products[i].id
          htmls += `<div class="col-lg-4 col-md-6 col-sm-6 pb-1 products-container ">
                        <div class="product-item bg-light mb-4">
                            <div class="product-img position-relative overflow-hidden">
                                <img class="img-fluid w-100" src="/ecommerce/media/${products[i].avatar}" alt="">
                                <div class="product-action">
                                    <a class="btn btn-outline-dark btn-square" href="./productdetail/${id}"><i class="fa fa-shopping-cart"></i></a>
                                    <a class="btn btn-outline-dark btn-square" href=""><i class="far fa-heart"></i></a>
                                    <a class="btn btn-outline-dark btn-square" href="./productdetail/${id}"><i class="fa fa-search"></i></a>
                                </div> 
                            </div>
                            <div class="text-center py-4">
                                <a class="h6 text-decoration-none text-truncate" href="">${products[i].title}</a>
                                <div class="d-flex align-items-center justify-content-center mt-2">
                                    <h5> ${Math.round((products[i].price * "{{currency}}") * 100) / 100} {% get_icon_currency currency_name %} </h5>
                                </div>
                                <div class="d-flex align-items-center justify-content-center mb-1">
                                    <small class="fa fa-star text-primary mr-1"></small>
                                    <small class="fa fa-star text-primary mr-1"></small>
                                    <small class="fa fa-star text-primary mr-1"></small>
                                    <small class="fa fa-star text-primary mr-1"></small>
                                    <small class="fa fa-star text-primary mr-1"></small>
                                </div>
                            </div>
                        </div>
                    </div>`

                  }
                  
                  $('.products-item').append(htmls)
}


  function addcart(id) {
    $.ajax({
      url: "{% url 'cart' %}",
      type: 'POST',
      data: {
        id: id,
        csrfmiddlewaretoken: '{{ csrf_token }}',
      },
      success: function (count) {
        $('.count_carts').text(count)
      },
    })
  }

  function addWishList(id) {
    $.ajax({
      url: "{% url 'wishlist' %}",
      type: 'POST',
      data: {
        id: id,
        csrfmiddlewaretoken: '{{ csrf_token }}',
      },
      success: function (count) {
        $('.count_wishlists').text(count)
      },
    })
}

  function search_ajax() {
    const query = $('.form-control-search').val()
    $.ajax({
      url: "{% url 'search_product' product.category.id  %}",
      type: 'GET',
      data: {
        query: query,
      },
      success: function (data) {
        AppendProducts(data)
      },
    })
  }

</script>

<script>
    $('.custom-control-input').click( () => {
        const price = (event.target.id).split('-')[1]
        $.ajax({
            url: "{% url 'filter' product.category.id %}",
            type: 'GET',
            data: {
                'price': price,
            },
            success: function(data) {
                AppendProducts(data)
            }
        })
    } )

</script>

<script>
$(document).ready(function(){
  $(".liveToastBtn").click(function(){
    $('.toast').toast('show');
  });
});

$(document).ready(function(){
  $(".liveToastBtn").click(function(){
    $('.toast').toast('show');
  });
});
</script>

{% endblock %}
