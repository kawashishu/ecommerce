{% extends 'base.html' %} {% load i18n %} {% load static %} {% block content %}
{% load post_tags %}

<body>
  <!-- Breadcrumb Start -->
  <div class="container-fluid">
    <div class="row px-xl-5">
      <div class="col-12">
        <nav class="breadcrumb bg-light mb-30">
          <a class="breadcrumb-item text-dark" href=" {% url 'index' %} "
            >Home</a
          >
          <a class="breadcrumb-item text-dark" href="#">Shop</a>
          <span class="breadcrumb-item active">Shop Detail</span>
        </nav>
      </div>
    </div>
  </div>
  <!-- Breadcrumb End -->

  <!-- Shop Detail Start -->
  <div class="container-fluid pb-5">
    <div class="row px-xl-5">
      <div class="col-lg-5 mb-30">
        <div id="product-carousel" class="carousel slide" data-ride="carousel">
          <div class="carousel-inner bg-light">
            <div class="carousel-item active">
              <img
                class="w-100 h-100"
                src="/ecommerce/media/{{product.avatar}}"
                alt="Image"
              />
            </div>
            <div class="carousel-item">
              <img
                class="w-100 h-100"
                src="{% static 'img/product-2.jpg'%}"
                alt="Image"
              />
            </div>
            <div class="carousel-item">
              <img
                class="w-100 h-100"
                src="{% static 'img/product-3.jpg'%}"
                alt="Image"
              />
            </div>
            <div class="carousel-item">
              <img
                class="w-100 h-100"
                src="{% static 'img/product-4.jpg'%}"
                alt="Image"
              />
            </div>
          </div>
          <a
            class="carousel-control-prev"
            href="#product-carousel"
            data-slide="prev"
          >
            <i class="fa fa-2x fa-angle-left text-dark"></i>
          </a>
          <a
            class="carousel-control-next"
            href="#product-carousel"
            data-slide="next"
          >
            <i class="fa fa-2x fa-angle-right text-dark"></i>
          </a>
        </div>
      </div>

      <div class="col-lg-7 h-auto mb-30">
        <div class="h-100 bg-light p-30">
          <h3>{{ product.title }}</h3>
          <div class="d-flex mb-3">
            <div class="text-primary mr-2">
              <small class="fas fa-star"></small>
              <small class="fas fa-star"></small>
              <small class="fas fa-star"></small>
              <small class="fas fa-star-half-alt"></small>
              <small class="far fa-star"></small>
            </div>
            <p class="pt-1 ml-3">({{comments.count}} Reviews)</p>
            <p class="pt-1 ml-3">({{product.views}} access times)</p>
          </div>
          {% multiply product.price currency as price %}
          <h3 class="font-weight-semi-bold mb-4">{{ price }} {% get_icon_currency currency_name %}</h3>
          <p class="mb-4">{{ product.decripstion }}</p>
          <div class="d-flex align-items-center mb-4 pt-2">
            <a onclick="addcart({{product.id}})" class="btn btn-primary px-3"
              ><i class="fa fa-shopping-cart mr-1"></i> Add To Cart</a
            >
          </div>
          <div class="d-flex pt-2">
            <strong class="text-dark mr-2">Share on:</strong>
            <div class="d-inline-flex">
              <a
                class="text-dark px-2"
                href="https://www.facebook.com/sharer/sharer.php?u=example.org"
                target="_blank"
              >
                <i class="fab fa-facebook-f"></i>
              </a>
              <a class="text-dark px-2" href="https://twitter.com/intent/tweet">
                <i class="fab fa-twitter"></i>
              </a>
            </div>
          </div>
          <div class="pt-5">
            <a href="{% url 'checkout' %}" class="btn btn-primary px-3"
              ><i class="fa fa-shopping-cart mr-1"></i> Checkout
            </a>
          </div>
        </div>
      </div>
    </div>

    <div class="row px-xl-5">
      <div class="col">
        <div class="bg-light p-30">
          <div class="nav nav-tabs mb-4">
            <a
              class="nav-item nav-link text-dark active"
              data-toggle="tab"
              href="#tab-pane-1"
              >Description</a
            >
            <a
              class="nav-item nav-link text-dark"
              data-toggle="tab"
              href="#tab-pane-2"
              >Information</a
            >
            <a
              class="nav-item nav-link text-dark"
              data-toggle="tab"
              href="#tab-pane-3"
              >Reviews ({{comments.count}})</a
            >
          </div>
          <div class="tab-content">
            <div class="tab-pane fade show active" id="tab-pane-1">
              <h4 class="mb-3">Product Description</h4>
              <p>
                Eos no lorem eirmod diam diam, eos elitr et gubergren diam sea.
                Consetetur vero aliquyam invidunt duo dolores et duo sit. Vero
                diam ea vero et dolore rebum, dolor rebum eirmod consetetur
                invidunt sed sed et, lorem duo et eos elitr, sadipscing kasd
                ipsum rebum diam. Dolore diam stet rebum sed tempor kasd eirmod.
                Takimata kasd ipsum accusam sadipscing, eos dolores sit no ut
                diam consetetur duo justo est, sit sanctus diam tempor aliquyam
                eirmod nonumy rebum dolor accusam, ipsum kasd eos consetetur at
                sit rebum, diam kasd invidunt tempor lorem, ipsum lorem elitr
                sanctus eirmod takimata dolor ea invidunt.
              </p>
              <p>
                Dolore magna est eirmod sanctus dolor, amet diam et eirmod et
                ipsum. Amet dolore tempor consetetur sed lorem dolor sit lorem
                tempor. Gubergren amet amet labore sadipscing clita clita diam
                clita. Sea amet et sed ipsum lorem elitr et, amet et labore
                voluptua sit rebum. Ea erat sed et diam takimata sed justo.
                Magna takimata justo et amet magna et.
              </p>
            </div>
            <div class="tab-pane fade" id="tab-pane-2">
              <h4 class="mb-3">Additional Information</h4>
              <p>
                Eos no lorem eirmod diam diam, eos elitr et gubergren diam sea.
                Consetetur vero aliquyam invidunt duo dolores et duo sit. Vero
                diam ea vero et dolore rebum, dolor rebum eirmod consetetur
                invidunt sed sed et, lorem duo et eos elitr, sadipscing kasd
                ipsum rebum diam. Dolore diam stet rebum sed tempor kasd eirmod.
                Takimata kasd ipsum accusam sadipscing, eos dolores sit no ut
                diam consetetur duo justo est, sit sanctus diam tempor aliquyam
                eirmod nonumy rebum dolor accusam, ipsum kasd eos consetetur at
                sit rebum, diam kasd invidunt tempor lorem, ipsum lorem elitr
                sanctus eirmod takimata dolor ea invidunt.
              </p>
              <div class="row">
                <div class="col-md-6">
                  <ul class="list-group list-group-flush">
                    <li class="list-group-item px-0">
                      Sit erat duo lorem duo ea consetetur, et eirmod takimata.
                    </li>
                    <li class="list-group-item px-0">
                      Amet kasd gubergren sit sanctus et lorem eos sadipscing
                      at.
                    </li>
                    <li class="list-group-item px-0">
                      Duo amet accusam eirmod nonumy stet et et stet eirmod.
                    </li>
                    <li class="list-group-item px-0">
                      Takimata ea clita labore amet ipsum erat justo voluptua.
                      Nonumy.
                    </li>
                  </ul>
                </div>
                <div class="col-md-6">
                  <ul class="list-group list-group-flush">
                    <li class="list-group-item px-0">
                      Sit erat duo lorem duo ea consetetur, et eirmod takimata.
                    </li>
                    <li class="list-group-item px-0">
                      Amet kasd gubergren sit sanctus et lorem eos sadipscing
                      at.
                    </li>
                    <li class="list-group-item px-0">
                      Duo amet accusam eirmod nonumy stet et et stet eirmod.
                    </li>
                    <li class="list-group-item px-0">
                      Takimata ea clita labore amet ipsum erat justo voluptua.
                      Nonumy.
                    </li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="tab-pane fade" id="tab-pane-3">
              <div class="row">
                <div class="col-md-6">
                  <h4 class="mb-4">
                    {{comments.count}} review for "{{product.title}}"
                  </h4>
                  <ul class="list-group container-comments">
                    {% for comment in comments %}
                    <li class="list-group-item container-comment">
                      <div class="media mb-4">
                        <img
                          src="/ecommerce/media/{{comment.customer.avatar}}"
                          alt="Image"
                          class="img-fluid mr-3 mt-1"
                          style="width: 45px"
                        />
                        <div class="media-body">
                          <h6>
                            {{comment.customer.name}}<small>
                              - <i>{{comment.created}}</i></small
                            >
                          </h6>
                          <div class="text-primary mb-2">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star-half-alt"></i>
                            <i class="far fa-star"></i>
                          </div>
                          <p>{{comment.content}}</p>
                          {% if request.user == comment.customer %}
                          <button
                            onclick="deleteComment('{{comment.id}}', '{{product.id}}')"
                            class="btn btn-sm btn-danger"
                          >
                            Delete
                          </button>
                          {% endif %}
                        </div>
                      </div>
                    </li>
                    {% endfor %}
                  </ul>
                </div>
                <div class="col-md-6">
                  <h4 class="mb-4">Leave a review</h4>
                  <small
                    >Your email address will not be published. Required fields
                    are marked *</small
                  >
                  <div class="d-flex my-3"></div>
                  <div class="form-group">
                    <label for="message">Your Review *</label>
                    <textarea
                      name="message"
                      id="message"
                      cols="60"
                      rows="10"
                    ></textarea>
                    <div class="form-group mb-0">
                      <button
                        onclick="addComment('{{product.id}}', '{{request.user.id}}', )"
                        class="btn btn-primary px-3"
                      >
                        Add your comment
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Shop Detail End -->
  <!-- Products Start -->
  <div class="container-fluid py-5">
    <h2 class="section-title position-relative text-uppercase mx-xl-5 mb-4">
      <span class="bg-secondary pr-3">You May Also Like</span>
    </h2>
    <div class="row px-xl-5">
      <div class="col">
        <div class="owl-carousel related-carousel">
          {% for product in products %}
          <div class="product-item bg-light">
            <div class="product-img position-relative overflow-hidden">
              <img
                class="img-fluid w-100"
                src="/ecommerce/media/{{product.avatar}}"
                alt=""
              />
              <div class="product-action">
                <a onclick="addcart({{product.id}})" class="btn btn-outline-dark btn-square"
                  ><i class="fa fa-shopping-cart"></i
                ></a>
                <a onclick="addWishList({{product.id}})" class="btn btn-outline-dark btn-square"
                  ><i class="far fa-heart"></i
                ></a>
                <a class="btn btn-outline-dark btn-square" href="{% url 'productdetail' product.id %}"
                  ><i class="fa fa-search"></i
                ></a>
              </div>
            </div>
            <div class="text-center py-4">
              <a class="h6 text-decoration-none text-truncate" href=""
                >{{product.title}}</a
              >
              <div
                class="d-flex align-items-center justify-content-center mt-2"
              >
              {% multiply product.price currency as price %}
                <h5>{{ price }} {% get_icon_currency currency_name %}</h5>
              </div>
              <div
                class="d-flex align-items-center justify-content-center mb-1"
              >
                <small class="fa fa-star text-primary mr-1"></small>
                <small class="fa fa-star text-primary mr-1"></small>
                <small class="fa fa-star text-primary mr-1"></small>
                <small class="fa fa-star text-primary mr-1"></small>
                <small class="fa fa-star text-primary mr-1"></small>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
  <!-- Products End -->
</body>

<script
  src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"
  type="text/javascript"
></script>

<script>
  function AppendComment(data) {
    comment = data.comment;
    user = data.user;
    var target = event.target;
    let htmls = "";
    htmls += `
          <li class="list-group-item  container-comment">
            <div class="media mb-4">
                <img src="/ecommerce/media/{{request.user.avatar}}" alt="Image" class="img-fluid mr-3 mt-1" style="width: 45px;">
                <div class="media-body">
                    <h6>${user}<small> - <i>${comment[0].created}</i></small></h6>
                    <div class="text-primary mb-2">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star-half-alt"></i>
                        <i class="far fa-star"></i>
                    </div>
                    <p>${comment[0].content}</p>
                    <button onclick="deleteComment('${comment[0].content}', '${comment[0].product}')" class="btn btn-sm btn-danger">Delete</button>
                </div>
            </div>
            </li>
          `;
    $(".container-comments").append(htmls);
  }

  function addComment(product_id, user_id) {
    var message = $("#message").val();
    var url = "{% url 'create_comment' 1 %} ";
    url.replace("1", product_id);
    var data = {
      content: message,
      product_id: product_id,
      user_id: user_id,
      csrfmiddlewaretoken: "{{ csrf_token }}",
    };
    $.ajax({
      type: "POST",
      url: url,
      data: data,
      success: function (comment) {
        AppendComment(comment);
      },
    });
  }

  function deleteComment(comment, product_id) {
    var url = "{% url 'delete_comment' 1 %} ";
    url.replace("1", product_id);
    console.log(comment);
    const object = event.target;
    $.ajax({
      url: url,
      type: "POST",
      data: {
        comment_id: comment,
        csrfmiddlewaretoken: "{{ csrf_token }}",
      },
      success: function (response) {
        $(object).closest("li").remove();
      },
    });
  }

  function addcart(id) {
    $.ajax({
      url: "{% url 'cart' %}",
      type: 'POST',
      data: {
        id: id,
        csrfmiddlewaretoken: '{{ csrf_token }}',
      },
      success: function (count) {
        $('.shopping-cart').text(count)
      },
    })
  }

  function addWishList(id) {
    $.ajax({
      url: "{% url 'wishlist' %}",
      type: 'POST',
      data: {
        id: id,
        csrfmiddlewaretoken: '{{ csrf_token }}',
      },
      success: function (count) {
        $('.wishlist').text(count)
      },
    })
}

  
</script>

{% endblock %}
